import{r as f,j as e}from"./iframe-CbZ9RuD1.js";import{h as W}from"./table-fixtures-VRmzXp_h.js";import{D as S,h as V,c as G,S as M,i as H,u as K,a as $,g as z}from"./streaming-handlers-CgBbc_-g.js";import{I as y}from"./input-DudEH1ht.js";import{D as A}from"./DateInput-74xO5tlQ.js";import{S as J}from"./SearchButton-CIUEaMGJ.js";import{b as Q,a as X,C as N}from"./badge-cell-fL0iak6c.js";import{f as Y,b as Z}from"./text-formatters-hhISWS8n.js";import{R as ee}from"./RuleStateBadge-C-ZAzyeY.js";import{R as g}from"./rucio-BBdC5vD1.js";import{N as te}from"./NullBadge-dlHFD71l.js";import{r as ae,a as re,b as ne}from"./rule-sorting-utils-CA35suoB.js";import{B as ie}from"./button-CTUPBRYB.js";import{i as le,j as se}from"./index.esm-CDVKQKGR.js";import{U as oe}from"./index.esm-Bh9o6rCW.js";import{S as de,a as ce,b as ue,c as me,d as T}from"./select-BSUdR0U-.js";import{T as pe}from"./ToastedTemplate-BGCvPkR0.js";import{g as fe}from"./index-vMKhJVm3.js";import"./preload-helper-Dp1pzeXC.js";import"./Skeleton-DWlDUj5U.js";import"./index-DSpI4bVK.js";import"./utils-DsKtx5Xo.js";import"./tw-merge-Ds6tgvmq.js";import"./index-BVAf5DAB.js";import"./index-CY5-pjTU.js";import"./LoadingSpinner-DNn-SVom.js";import"./useToast-YXabfrDf.js";import"./list-toasts-CqaY5F_J.js";import"./index-COXxs0hY.js";import"./warning-C20GYw-A.js";import"./Badge-ClFuoEMl.js";import"./iconBase-BDSQWw1B.js";import"./index-YEY9OEgd.js";import"./index-B5AF9blO.js";import"./index-Dwd-kS-d.js";import"./Combination-C2wgG2I7.js";import"./index-_REj2qAT.js";import"./index-CeuYnBzV.js";import"./index-CzukIY3d.js";import"./index-jI6H8jZ4.js";import"./Toaster-CU-bfwMZ.js";import"./index-CI9TgWTM.js";const ge=t=>e.jsx(N,{href:`/rule/page/${t.value}`,children:t.value}),he=t=>{const[a,l]=t.value;return e.jsxs(N,{href:`/did/page/${encodeURIComponent(a)}/${encodeURIComponent(l)}`,children:[a,":",l]})},xe=t=>e.jsx(N,{href:`/rse/list?expression=${encodeURIComponent(t.value)}&autoSearch=true`,children:t.value}),ve=t=>{const a=Z(t.value);return a||e.jsx(te,{})},P=t=>{const a=f.useRef(null),[l]=f.useState([{headerName:"DID",valueGetter:i=>{var s,d;return[(s=i.data)==null?void 0:s.scope,(d=i.data)==null?void 0:d.name]},minWidth:350,flex:2,filter:!0,filterParams:S,cellRenderer:he,pinned:"left"},{headerName:"ID",field:"id",width:50,minWidth:100,flex:1,cellRenderer:ge,pinned:"left",filter:!0,filterParams:S},{headerName:"RSE Expression",field:"rse_expression",minWidth:160,flex:1,cellRenderer:xe,filter:!0,filterParams:S},{headerName:"State",field:"state",width:150,minWidth:150,cellStyle:X,cellRenderer:ee,cellRendererParams:{className:Q},filter:!0,filterParams:G(Object.values(H),Object.values(g)),sortable:!0,comparator:ae},{headerName:"OK",field:"locks_ok_cnt",width:80,minWidth:80,filter:"agNumberColumnFilter"},{headerName:"Replicating",field:"locks_replicating_cnt",width:125,minWidth:125,filter:"agNumberColumnFilter"},{headerName:"Stuck",field:"locks_stuck_cnt",width:95,minWidth:95,sortable:!0,comparator:re,filter:"agNumberColumnFilter"},{headerName:"Account",field:"account",minWidth:120,flex:1,filter:!0,filterParams:S},{headerName:"Created At",field:"created_at",width:140,minWidth:140,valueFormatter:i=>Y(i.value),filter:"agDateColumnFilter",filterParams:V},{headerName:"Remaining",field:"remaining_lifetime",width:140,minWidth:140,cellRenderer:ve,sortable:!0,comparator:ne}]),u=i=>{t.onGridReady(i),i.api.applyColumnState({state:[{colId:"state",sort:"desc"}]})};return e.jsx(M,{columnDefs:l,tableRef:a,...t,onGridReady:u})};P.__docgenInfo={description:"",methods:[],displayName:"ListRuleTable",props:{streamingHook:{required:!0,tsType:{name:"UseStreamReader",elements:[{name:"RuleViewModel"}],raw:"UseStreamReader<RuleViewModel>"},description:""},onGridReady:{required:!0,tsType:{name:"signature",type:"function",raw:"(event: GridReadyEvent) => void",signature:{arguments:[{type:{name:"GridReadyEvent"},name:"event"}],return:{name:"void"}}},description:""}}};const b="*",Se=({isExpanded:t,onToggle:a})=>e.jsx("div",{className:"relative",children:e.jsxs(ie,{className:"px-3",variant:"neutral",onClick:a,"aria-expanded":t,"aria-label":"Toggle filters",children:[e.jsx(oe,{}),t?e.jsx(le,{className:"ml-1"}):e.jsx(se,{className:"ml-1"})]})}),ye=({value:t,onChange:a,onSearch:l,onFilterToggle:u,isFilterExpanded:i,id:s})=>{const d=m=>{const c=m.target.value;a(c)};return e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(y,{id:s,className:"w-full sm:flex-grow",onChange:d,onEnterKey:l,placeholder:"Current Account",value:t}),e.jsx(Se,{isExpanded:i,onToggle:u})]})};function p({children:t,label:a}){return e.jsxs("div",{className:"grow flex-1",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2 block",children:a}),t]})}const be=({filters:t,onFiltersChange:a})=>{const l=n=>{a({activity:n.target.value})},u=n=>{n===g.UNKNOWN?a({state:void 0}):a({state:n})},i=n=>{const v=n.target.value||b;a({scope:v})},s=n=>{a({name:n.target.value})},d=n=>{a({updatedAfter:n})},m=n=>{a({updatedBefore:n})},c="flex flex-col sm:flex-row w-full gap-4";return e.jsxs("div",{className:"rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 p-6 space-y-6",children:[e.jsxs("div",{className:c,children:[e.jsx(p,{label:"Activity",children:e.jsx(y,{className:"w-full",value:t.activity,onChange:l,placeholder:"Any Activity"})}),e.jsx(p,{label:"State",children:e.jsxs(de,{onValueChange:u,defaultValue:void 0,value:t.state,children:[e.jsx(ce,{className:"w-full",children:e.jsx(ue,{placeholder:"Any"})}),e.jsxs(me,{children:[e.jsx(T,{value:g.UNKNOWN,children:"Any"}),Object.values(g).map(n=>n===g.UNKNOWN?null:e.jsx(T,{value:n,children:n},n))]})]})})]}),e.jsxs("div",{className:c,children:[e.jsx(p,{label:"Scope",children:e.jsx(y,{className:"w-full",value:t.scope===b?"":t.scope,onChange:i,placeholder:b})}),e.jsx(p,{label:"Name",children:e.jsx(y,{className:"w-full",value:t.name,onChange:s})})]}),e.jsxs("div",{className:c,children:[e.jsx(p,{label:"Updated After",children:e.jsx(A,{onchange:d,initialdate:t.updatedAfter,placeholder:"Select date"})}),e.jsx(p,{label:"Updated Before",children:e.jsx(A,{onchange:m,initialdate:t.updatedBefore,placeholder:"Select date"})})]})]})},Ne=({filters:t,onFiltersChange:a,onSearch:l,onStop:u,isRunning:i})=>{const[s,d]=f.useState(!1),m=()=>{d(!s)};return e.jsx("div",{className:"flex flex-col space-y-6 w-full",children:e.jsxs("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm p-6",children:[e.jsx("label",{htmlFor:"account-input",className:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-3 block",children:"Account"}),e.jsxs("div",{className:"flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-2 items-start",children:[e.jsxs("div",{className:"flex flex-col w-full space-y-4",children:[e.jsx(ye,{id:"account-input",value:t.account,onChange:c=>a({account:c}),onSearch:l,onFilterToggle:m,isFilterExpanded:s}),s&&e.jsx(be,{filters:t,onFiltersChange:a})]}),e.jsx(J,{className:"sm:w-48",isRunning:i,onStop:u,onSearch:l})]})]})})},j=t=>{var R,w,k,C,D;const[a,l]=f.useState({scope:((R=t.initialFilters)==null?void 0:R.scope)??b,account:((w=t.initialFilters)==null?void 0:w.account)??"",activity:((k=t.initialFilters)==null?void 0:k.activity)??"",state:((C=t.initialFilters)==null?void 0:C.state)??void 0,name:((D=t.initialFilters)==null?void 0:D.name)??"",updatedBefore:void 0,updatedAfter:void 0}),{onGridReady:u,streamingHook:i,startStreaming:s,stopStreaming:d,gridApi:m}=K(t.initialData),c=f.useRef(!1);f.useEffect(()=>{if(!c.current&&t.autoSearch&&m){c.current=!0;const r=v(a);s(r)}},[m]);const n=r=>{l(o=>({...o,...r}))},v=r=>{const o=new URLSearchParams;return r.scope&&o.append("scope",r.scope),r.name&&o.append("name",r.name),r.account&&o.append("account",r.account),r.activity&&o.append("activity",r.activity),r.state&&o.append("state",r.state),r.updatedBefore&&o.append("updated_before",r.updatedBefore.toISOString()),r.updatedAfter&&o.append("updated_after",r.updatedAfter.toISOString()),`/api/feature/list-rules?${o.toString()}`},F=r=>{r.preventDefault(),t.onSearchStart&&t.onSearchStart(a);const o=v(a);s(o)},O=r=>{r.preventDefault(),d()};return e.jsxs("div",{className:"flex flex-col space-y-6 w-full",children:[e.jsx(Ne,{filters:a,onFiltersChange:n,onSearch:F,onStop:O,isRunning:i.status===$.RUNNING}),e.jsx("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm overflow-hidden h-[calc(100vh-24rem)]",children:e.jsx(P,{streamingHook:i,onGridReady:u})})]})};j.__docgenInfo={description:"",methods:[],displayName:"ListRule",props:{initialData:{required:!1,tsType:{name:"Array",elements:[{name:"RuleViewModel"}],raw:"RuleViewModel[]"},description:""},autoSearch:{required:!1,tsType:{name:"boolean"},description:""},initialFilters:{required:!1,tsType:{name:"Partial",elements:[{name:"signature",type:"object",raw:`{
    scope: string;
    name: string;
    account: string;
    activity: string;
    state?: RuleState;
    updatedBefore?: Date;
    updatedAfter?: Date;
}`,signature:{properties:[{key:"scope",value:{name:"string",required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"account",value:{name:"string",required:!0}},{key:"activity",value:{name:"string",required:!0}},{key:"state",value:{name:"RuleState",required:!1}},{key:"updatedBefore",value:{name:"Date",required:!1}},{key:"updatedAfter",value:{name:"Date",required:!1}}]}}],raw:"Partial<SearchFilters>"},description:""},onSearchStart:{required:!1,tsType:{name:"signature",type:"function",raw:"(filters: SearchFilters) => void",signature:{arguments:[{type:{name:"signature",type:"object",raw:`{
    scope: string;
    name: string;
    account: string;
    activity: string;
    state?: RuleState;
    updatedBefore?: Date;
    updatedAfter?: Date;
}`,signature:{properties:[{key:"scope",value:{name:"string",required:!0}},{key:"name",value:{name:"string",required:!0}},{key:"account",value:{name:"string",required:!0}},{key:"activity",value:{name:"string",required:!0}},{key:"state",value:{name:"RuleState",required:!1}},{key:"updatedBefore",value:{name:"Date",required:!1}},{key:"updatedAfter",value:{name:"Date",required:!1}}]}},name:"filters"}],return:{name:"void"}}},description:""}}};const ut={title:"Components/Pages/Rule/List",component:j,parameters:{docs:{disable:!0}}},L=t=>e.jsx(pe,{children:e.jsx(j,{...t})}),h=L.bind({});h.args={initialData:Array.from({length:50},()=>W())};const x=L.bind({});x.decorators=[fe([z("/api/feature/list-rules",{data:Array.from({length:500},W),delay:1})])];var I,q,U;h.parameters={...h.parameters,docs:{...(I=h.parameters)==null?void 0:I.docs,source:{originalSource:`args => <ToastedTemplate>
        <ListRule {...args} />
    </ToastedTemplate>`,...(U=(q=h.parameters)==null?void 0:q.docs)==null?void 0:U.source}}};var _,E,B;x.parameters={...x.parameters,docs:{...(_=x.parameters)==null?void 0:_.docs,source:{originalSource:`args => <ToastedTemplate>
        <ListRule {...args} />
    </ToastedTemplate>`,...(B=(E=x.parameters)==null?void 0:E.docs)==null?void 0:B.source}}};const mt=["InitialDataNoEndpoint","RegularStreaming"];export{h as InitialDataNoEndpoint,x as RegularStreaming,mt as __namedExportsOrder,ut as default};
