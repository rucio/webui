import{j as e,R as ze,r as m}from"./iframe-CbZ9RuD1.js";import{T as $e}from"./ToastedTemplate-BGCvPkR0.js";import{H as L}from"./Heading-BBK5GD02.js";import{c as M}from"./utils-DsKtx5Xo.js";import{C as He}from"./CircleWithText-V1QaHt8L.js";import{D as Qe}from"./Divider-DGCuNmkS.js";import{b as K,H as Ke,e as Be,g as Ye,f as Je,n as Xe,m as Ze}from"./index.esm-Bh9o6rCW.js";import{B as ve}from"./button-CTUPBRYB.js";import{D as O,c as Y,S as be,R as G,u as je,a as Se,b as et,g as se}from"./streaming-handlers-CgBbc_-g.js";import{D as tt}from"./DIDSearchPanel-DAhpNlKd.js";import{a as b}from"./text-formatters-hhISWS8n.js";import{D as J}from"./DIDTypeBadge-D02io31O.js";import{b as X,a as Z,C as at}from"./badge-cell-fL0iak6c.js";import{D as h}from"./rucio-BBdC5vD1.js";import{I as P}from"./InfoField-BfxqvlKm.js";import{W as Ne}from"./WarningField-D_GotWnc.js";import{C as we}from"./checkbox-Dm_TBBEE.js";import{R as rt,C as st,c as nt}from"./RSESearchPanel-BgaHAOar.js";import{L as it}from"./LoadingSpinner-DNn-SVom.js";import{I as U,T as lt}from"./input-DudEH1ht.js";import{S as ot,a as dt,b as ut,c as ct,e as mt,d as V}from"./select-BSUdR0U-.js";import{C as Ce,a as De,b as Re}from"./Collapsible-BwiryoPl.js";import{u as pt,Q as ft}from"./useQuery-1gHWNmmy.js";import{u as xt}from"./useToast-YXabfrDf.js";import{L as ne}from"./link-CLCsOSg8.js";import{A as gt}from"./Alert-DSW6oEjQ.js";import{z as ht}from"./index-CY5-pjTU.js";import{n as ie}from"./image-DZ-qLyqj.js";import{m as S}from"./proxy-vEXAzVUV.js";import{u as yt}from"./use-reduced-motion-CgJySeb8.js";import{g as vt}from"./index-vMKhJVm3.js";import{b as bt,k as jt,l as St}from"./table-fixtures-VRmzXp_h.js";import{Q as Nt,g as wt}from"./single-handlers-XctvBmPm.js";import"./preload-helper-Dp1pzeXC.js";import"./Toaster-CU-bfwMZ.js";import"./index-BVAf5DAB.js";import"./index-YEY9OEgd.js";import"./index-B5AF9blO.js";import"./index-Dwd-kS-d.js";import"./index-CI9TgWTM.js";import"./index-DSpI4bVK.js";import"./list-toasts-CqaY5F_J.js";import"./tw-merge-Ds6tgvmq.js";import"./iconBase-BDSQWw1B.js";import"./Skeleton-DWlDUj5U.js";import"./SearchButton-CIUEaMGJ.js";import"./index.esm-CDVKQKGR.js";import"./DateInput-74xO5tlQ.js";import"./index-COXxs0hY.js";import"./warning-C20GYw-A.js";import"./TimeInput-CUCbVHI4.js";import"./Badge-ClFuoEMl.js";import"./Field-CSa0GJHY.js";import"./index-jI6H8jZ4.js";import"./index-CzukIY3d.js";import"./Combination-C2wgG2I7.js";import"./index-_REj2qAT.js";import"./index-CeuYnBzV.js";var k=(function(t){return t.ALL="All",t.DATASET="Dataset",t.NONE="None",t})({});const Ct=()=>({askApproval:!1,needsApproval:!1,asynchronous:!1,copies:1,daysLifetime:void 0,dids:[],grouping:void 0,sample:!1,notify:!1,rses:[]}),Ie=({steps:t,activeIndex:r,onSwitch:s})=>e.jsx("div",{className:"flex flex-row justify-between items-center overflow-x-auto",children:t.map((a,n)=>{const i=(n+1).toString();let c;n===r?c="bg-brand-500":n<r?c="bg-base-success-500":c="bg-neutral-0 dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100";const p=n<r&&s;return e.jsxs(ze.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center space-x-2",children:[e.jsx(He,{className:M("bg-opacity-80 font-semibold",c),text:i,onClick:p?()=>s(n):void 0}),e.jsx("span",{className:"text-neutral-900 dark:text-neutral-100 hidden md:inline",children:a})]}),n<t.length-1&&e.jsx(Qe,{className:"height-fit mx-3",color:"bg-neutral-300 dark:bg-neutral-700"})]},a)})});Ie.__docgenInfo={description:"",methods:[],displayName:"Timeline",props:{steps:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},activeIndex:{required:!0,tsType:{name:"number"},description:""},onSwitch:{required:!1,tsType:{name:"signature",type:"function",raw:"(idx: number) => void",signature:{arguments:[{type:{name:"number"},name:"idx"}],return:{name:"void"}}},description:""}}};const Te="flex flex-row items-center space-x-2",B="h-5 w-5",ee=t=>{const r=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t.onSelect())};return e.jsxs("div",{className:Te,onClick:t.onSelect,onKeyDown:r,role:"button",tabIndex:0,"aria-pressed":t.selected,children:[t.selected?e.jsx(K,{className:`flex-shrink-0 text-base-success-600 ${B}`}):e.jsx(Ke,{className:`flex-shrink-0 text-brand-500 ${B}`}),e.jsx("span",{children:t.value})]})},te=t=>{const r=s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),t.onClick())};return e.jsxs("div",{className:Te,onClick:t.onClick,onKeyDown:r,role:"button",tabIndex:0,children:[e.jsx(Be,{className:`flex-shrink-0 text-base-error-500 ${B}`}),e.jsx("span",{children:t.value})]})};ee.__docgenInfo={description:"",methods:[],displayName:"SelectableCell",props:{onSelect:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},selected:{required:!0,tsType:{name:"boolean"},description:""},value:{required:!0,tsType:{name:"string"},description:""}}};te.__docgenInfo={description:"",methods:[],displayName:"RemovableCell",props:{onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},value:{required:!0,tsType:{name:"string"},description:""}}};const Dt={[h.FILE]:"File",[h.DATASET]:"Dataset",[h.CONTAINER]:"Container",[h.COLLECTION]:"Collection",[h.ALL]:"All"},ke=({addDID:t,removeDID:r,selectedItems:s,...a})=>{const n=m.useRef(null),[i]=m.useState([{headerName:"Identifier",flex:1,valueGetter:p=>{var l,o;return`${(l=p.data)==null?void 0:l.scope}:${(o=p.data)==null?void 0:o.name}`},cellRenderer:p=>{const l=p.data;l.selected=l.selected??s.some(d=>d.scope===l.scope&&d.name===l.name);const o=()=>l.selected?r(l):t(l);return e.jsx(ee,{selected:l.selected,onSelect:o,...p})},minWidth:450,filter:!0,filterParams:O},{headerName:"Type",field:"did_type",cellRenderer:J,minWidth:180,cellStyle:Z,cellRendererParams:{className:X},filter:!0,filterParams:Y(Object.values(Dt),Object.values(h))},{headerName:"Size",field:"bytes",valueFormatter:p=>b(p.value),minWidth:200,filter:"agNumberColumnFilter"}]),c=()=>{var p,l;(l=(p=n.current)==null?void 0:p.api)==null||l.forEachNode(o=>{if(!o.data)return;const d=o.data,g=s.some(v=>v.scope===d.scope&&v.name===d.name);o.setData({...d,selected:g})})};return m.useEffect(()=>{c()},[s]),e.jsx(be,{columnDefs:i,tableRef:n,onAsyncTransactionsFlushed:()=>c(),...a})};ke.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageDataTable",props:{streamingHook:{required:!0,tsType:{name:"UseStreamReader",elements:[{name:"ListDIDsViewModel"}],raw:"UseStreamReader<ListDIDsViewModel>"},description:""},addDID:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: SelectableDIDViewModel) => void",signature:{arguments:[{type:{name:"SelectableDIDViewModel"},name:"item"}],return:{name:"void"}}},description:""},removeDID:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: SelectableDIDViewModel) => void",signature:{arguments:[{type:{name:"SelectableDIDViewModel"},name:"item"}],return:{name:"void"}}},description:""},onGridReady:{required:!0,tsType:{name:"signature",type:"function",raw:"(event: GridReadyEvent) => void",signature:{arguments:[{type:{name:"GridReadyEvent"},name:"event"}],return:{name:"void"}}},description:""},selectedItems:{required:!0,tsType:{name:"Array",elements:[{name:"ListDIDsViewModel"}],raw:"ListDIDsViewModel[]"},description:""}}};const Rt={[h.FILE]:"File",[h.DATASET]:"Dataset",[h.CONTAINER]:"Container",[h.COLLECTION]:"Collection",[h.ALL]:"All"},Ee=t=>{const r=m.useRef(null),[s]=m.useState([{headerName:"Identifier",flex:1,valueGetter:a=>{var n,i;return`${(n=a.data)==null?void 0:n.scope}:${(i=a.data)==null?void 0:i.name}`},cellRenderer:a=>{const n=a.data;return e.jsx(te,{onClick:()=>t.removeDID(n),...a})},minWidth:400},{headerName:"Type",field:"did_type",cellRenderer:J,minWidth:180,cellStyle:Z,cellRendererParams:{className:X},filter:!0,filterParams:Y(Object.values(Rt),Object.values(h))},{headerName:"Size",field:"bytes",valueFormatter:a=>b(a.value),minWidth:200,filter:"agNumberColumnFilter"}]);return e.jsx(G,{columnDefs:s,tableRef:r,...t})};Ee.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageDataSelectedTable",props:{rowData:{required:!0,tsType:{name:"Array",elements:[{name:"ListDIDsViewModel"}],raw:"ListDIDsViewModel[]"},description:""},removeDID:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: ListDIDsViewModel) => void",signature:{arguments:[{type:{name:"ListDIDsViewModel"},name:"item"}],return:{name:"void"}}},description:""}}};const R=({children:t})=>e.jsx("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm overflow-hidden h-[450px] flex flex-col",children:t});R.__docgenInfo={description:"",methods:[],displayName:"CreateRuleTableWrapper",props:{children:{required:!0,tsType:{name:"ReactNode"},description:""}}};const _e=({text:t,isOpen:r,onClick:s})=>{const a="h-7 w-7",n=i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),s())};return e.jsxs("div",{className:M("flex w-full justify-between items-center","cursor-pointer select-none","px-3 py-2","rounded-md border border-neutral-900 dark:border-neutral-100 border-opacity-10 dark:border-opacity-10","text-neutral-900 dark:text-neutral-100"),onClick:s,onKeyDown:n,role:"button",tabIndex:0,"aria-expanded":r,children:[e.jsx(L,{text:t,size:"sm"}),r?e.jsx(Ye,{className:a}):e.jsx(Je,{className:a})]})};_e.__docgenInfo={description:"",methods:[],displayName:"ToggleHeader",props:{text:{required:!0,tsType:{name:"string"},description:""},isOpen:{required:!0,tsType:{name:"boolean"},description:""},onClick:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Ae=t=>{const r=t.parameters.dids,s=r.reduce((d,g)=>d+g.bytes,0),{onGridReady:a,streamingHook:n,startStreaming:i,stopStreaming:c}=je(),[p,l]=m.useState(r.length===0),o=()=>{let d;return r.length===0?d=e.jsx("span",{children:"Please select at least one identifier"}):d=e.jsxs("span",{children:[r.length," chosen, ",b(s)," in total"]}),e.jsx(P,{children:d})};return e.jsxs("div",{className:M("flex flex-col space-y-6 w-full",t.visible?"visible":"hidden"),children:[e.jsx(_e,{text:"Search",isOpen:p,onClick:()=>l(d=>!d)}),e.jsxs("div",{className:`space-y-6 ${p?"visible":"hidden"}`,children:[e.jsx("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm p-6",children:e.jsx(tt,{startStreaming:i,stopStreaming:c,isRunning:n.status===Se.RUNNING})}),e.jsx(R,{children:e.jsx(ke,{streamingHook:n,onGridReady:a,addDID:d=>t.addDID(d),removeDID:d=>t.removeDID(d),selectedItems:r})})]}),r.length!==0&&e.jsx(R,{children:e.jsx(Ee,{rowData:r,removeDID:d=>t.removeDID(d)})}),o()]})};Ae.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageData",props:{visible:{required:!0,tsType:{name:"boolean"},description:""},parameters:{required:!0,tsType:{name:"CreateRuleParameters"},description:""},addDID:{required:!0,tsType:{name:"signature",type:"function",raw:"(did: ListDIDsViewModel) => void",signature:{arguments:[{type:{name:"ListDIDsViewModel"},name:"did"}],return:{name:"void"}}},description:""},removeDID:{required:!0,tsType:{name:"signature",type:"function",raw:"(did: ListDIDsViewModel) => void",signature:{arguments:[{type:{name:"ListDIDsViewModel"},name:"did"}],return:{name:"void"}}},description:""}}};const H=t=>{const r=t.warn?"text-base-error-500 font-semibold":"";return e.jsx("span",{className:r,children:t.value})},qe=({addRSE:t,removeRSE:r,selectedItems:s,...a})=>{const n=m.useRef(null),[i]=m.useState([{headerName:"Name",field:"rse",minWidth:250,flex:1,pinned:"left",cellRenderer:l=>{const o=l.data,d=s.some(v=>v.rse===o.rse);o.selected=o.selected??d;const g=()=>o.selected?r(o):t(o);return e.jsx(ee,{selected:o.selected,onSelect:g,...l})},filter:!0,filterParams:O},{headerName:"Quota",field:"bytes_limit",cellRenderer:l=>{const o=l.data;if(o.bytes_limit===-1&&o.has_quota)return"Infinite";const d=o.bytes_limit<0?"No quota":b(o.bytes_limit);return e.jsx(H,{warn:!o.has_quota,...l,value:d})},colSpan:l=>l.data.bytes_limit<0?3:1,minWidth:200,filter:"agNumberColumnFilter"},{headerName:"Total usage",field:"used_bytes",cellRenderer:l=>{const o=l.data,d=b(o.used_bytes+a.totalDataSize);return e.jsx(H,{warn:!o.has_quota,...l,value:d})},minWidth:200,filter:"agNumberColumnFilter"},{headerName:"Remaining",field:"bytes_remaining",cellRenderer:l=>{const o=l.data,d=b(o.bytes_remaining-a.totalDataSize);return e.jsx(H,{warn:!o.has_quota,...l,value:d})},minWidth:200,filter:"agNumberColumnFilter"}]),c=m.useCallback(()=>{var l,o;(o=(l=n.current)==null?void 0:l.api)==null||o.forEachNode(d=>{if(!d.data)return;const g=d.data,v=s.some(y=>y.rse===g.rse);d.setData({...g,selected:v})})},[s]);m.useEffect(()=>{c()},[c]);const p=l=>{a.onGridReady(l),l.api.applyColumnState({state:[{colId:"bytes_remaining",sort:"desc"}]})};return e.jsx(be,{columnDefs:i,tableRef:n,...a,onGridReady:p,onAsyncTransactionsFlushed:()=>c()})};qe.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageStorageTable",props:{streamingHook:{required:!0,tsType:{name:"UseStreamReader",elements:[{name:"RSEAccountUsageViewModel"}],raw:"UseStreamReader<RSEAccountUsageViewModel>"},description:""},addRSE:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: SelectableRSEViewModel) => void",signature:{arguments:[{type:{name:"SelectableRSEViewModel"},name:"item"}],return:{name:"void"}}},description:""},removeRSE:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: SelectableRSEViewModel) => void",signature:{arguments:[{type:{name:"SelectableRSEViewModel"},name:"item"}],return:{name:"void"}}},description:""},onGridReady:{required:!0,tsType:{name:"signature",type:"function",raw:"(event: GridReadyEvent) => void",signature:{arguments:[{type:{name:"GridReadyEvent"},name:"event"}],return:{name:"void"}}},description:""},totalDataSize:{required:!0,tsType:{name:"number"},description:""},selectedItems:{required:!0,tsType:{name:"Array",elements:[{name:"RSEAccountUsageLimitViewModel"}],raw:"RSEAccountUsageLimitViewModel[]"},description:""}}};const F=({checked:t,onChange:r,label:s,className:a})=>{const n=i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),r())};return e.jsxs("div",{className:M("flex flex-row items-center space-x-3 w-fit cursor-pointer",a),onClick:r,onKeyDown:n,role:"checkbox","aria-checked":t,tabIndex:0,children:[e.jsx(we,{checked:t}),e.jsx("span",{className:"select-none text-neutral-900 dark:text-neutral-100",children:s})]})};F.__docgenInfo={description:"",methods:[],displayName:"LabeledCheckbox",props:{checked:{required:!0,tsType:{name:"boolean"},description:""},onChange:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},label:{required:!0,tsType:{name:"string"},description:""},className:{required:!1,tsType:{name:"string"},description:""}}};const Le=t=>{const r=m.useRef(null),[s]=m.useState([{headerName:"RSE",field:"rse",flex:1,pinned:"left",cellRenderer:a=>{const n=a.data;return e.jsx(te,{onClick:()=>t.removeRSE(n),...a})},minWidth:200,filter:!0,filterParams:O},{headerName:"Used",field:"used_bytes",valueFormatter:a=>b(a.value),minWidth:120,filter:"agNumberColumnFilter"},{headerName:"Limit",field:"bytes_limit",valueFormatter:a=>a.value===-1?"Unlimited":b(a.value),minWidth:120,filter:"agNumberColumnFilter"},{headerName:"Remaining",field:"bytes_remaining",valueFormatter:a=>a.data.bytes_limit===-1?"Unlimited":b(a.value),minWidth:120,filter:"agNumberColumnFilter"}]);return e.jsx(G,{columnDefs:s,tableRef:r,...t})};Le.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageStorageSelectedTable",props:{rowData:{required:!0,tsType:{name:"Array",elements:[{name:"RSEAccountUsageLimitViewModel"}],raw:"RSEAccountUsageLimitViewModel[]"},description:""},removeRSE:{required:!0,tsType:{name:"signature",type:"function",raw:"(item: RSEAccountUsageLimitViewModel) => void",signature:{arguments:[{type:{name:"RSEAccountUsageLimitViewModel"},name:"item"}],return:{name:"void"}}},description:""}}};const It="*",Pe=t=>{const r=t.parameters.dids.reduce((x,w)=>x+w.bytes,0),s=t.parameters.rses,[a,n]=m.useState(t.parameters.needsApproval),[i,c]=m.useState(t.parameters.askApproval),{onGridReady:p,streamingHook:l,startStreaming:o,stopStreaming:d,gridApi:g}=je(),v=x=>{o("/api/feature/list-account-rse-quotas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rseExpression:x??It,requestedDIDs:t.parameters.dids})})},y=x=>{s.some(u=>u.rse===x.rse)||t.updateStorage({rses:[...s,x]})},C=x=>{const w=s.filter(u=>u.rse!==x.rse);t.updateStorage({rses:w})};m.useEffect(()=>{const x=s.some(u=>!!(u.bytes_remaining>=r||u.bytes_limit===-1&&u.has_quota)),w=s.length>0&&!x;n(w),t.updateNeedsApproval(w)},[s]),m.useEffect(()=>{t.updateAskApproval(i)},[i]);const N=a&&!i,z=()=>{let x;return s.length===0?x=e.jsx("span",{children:"Please select at least one RSE"}):x=e.jsxs("span",{children:[e.jsx("b",{children:s.length})," chosen"]}),e.jsx(P,{children:x})},$=()=>{let x;return s.length===1?x=e.jsx("span",{children:"The chosen RSE does not have enough quota left. Please choose different RSEs or mark the rule as in need of approval."}):x=e.jsxs("span",{children:["Out of ",e.jsx("b",{children:s.length})," chosen RSEs, none have enough quota left. Please choose different RSEs or mark the rule as needing approval."]}),e.jsx(Ne,{children:x})};return e.jsxs("div",{className:"flex flex-col space-y-6 w-full",children:[e.jsx("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm p-6",children:e.jsx(rt,{onSearch:v,stopStreaming:d,isRunning:l.status===Se.RUNNING,gridApi:g??void 0})}),e.jsx(R,{children:e.jsx(qe,{streamingHook:l,addRSE:y,removeRSE:C,onGridReady:p,totalDataSize:r,selectedItems:s})}),s.length!==0&&e.jsx(R,{children:e.jsx(Le,{rowData:s,removeRSE:C})}),N?$():z(),e.jsx(F,{checked:i,onChange:()=>c(x=>!x),label:"Ask for approval"})]})};Pe.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageStorage",props:{parameters:{required:!0,tsType:{name:"CreateRuleParameters"},description:""},updateStorage:{required:!0,tsType:{name:"signature",type:"function",raw:"(storage: CreateRuleStorage) => void",signature:{arguments:[{type:{name:"CreateRuleStorage"},name:"storage"}],return:{name:"void"}}},description:""},updateNeedsApproval:{required:!0,tsType:{name:"signature",type:"function",raw:"(needsApproval: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"needsApproval"}],return:{name:"void"}}},description:""},updateAskApproval:{required:!0,tsType:{name:"signature",type:"function",raw:"(askApproval: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"askApproval"}],return:{name:"void"}}},description:""}}};const E=({label:t,children:r,className:s,required:a,helpText:n,error:i,errorMessage:c})=>e.jsxs("div",{className:M("space-y-2",s),children:[e.jsxs("label",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:[t,a&&e.jsx("span",{className:"text-base-error-600 dark:text-base-error-500 ml-1",children:"*"})]}),n&&e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 -mt-1",children:n}),r,i&&c&&e.jsxs("p",{className:"text-sm text-base-error-600 dark:text-base-error-500 flex items-start gap-1",children:[e.jsx("span",{className:"font-medium",children:"Error:"}),e.jsx("span",{children:c})]})]}),le=()=>({commentsEmpty:!1,copiesInvalid:!1,groupingInvalid:!1,lifetimeInvalid:!1,tooManyCopies:!1,sampleCountInvalid:!1}),Tt=({parameters:t,updateOptionValue:r,errors:s})=>{const a=m.useRef(null),n=l=>{let o;l.currentTarget.validity.valid?o=l.currentTarget.value===""?void 0:parseInt(l.currentTarget.value,10):o=NaN,r("daysLifetime",o)},i=l=>{const o=new Date(l.currentTarget.value),d=new Date,g=Math.ceil((o.getTime()-d.getTime())/(1e3*60*60*24));r("daysLifetime",g),a.current&&(a.current.value=g.toString())},c=()=>{const l=new Date;return t.daysLifetime?new Date(l.setDate(l.getDate()+t.daysLifetime)).toISOString().split("T")[0]:""},p=()=>t.daysLifetime===void 0?"":isNaN(t.daysLifetime)?-1:t.daysLifetime;return e.jsxs(Ce,{className:"space-y-0",children:[e.jsx(De,{variant:"outline",className:"font-medium text-neutral-900 dark:text-neutral-100",children:"Lifetime"}),e.jsx(Re,{variant:"outline",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Days",helpText:"Number of days before the rule expires (leave empty for no expiration)",error:s.lifetimeInvalid,errorMessage:"Lifetime should be greater than 1 or not specified",children:e.jsx(U,{onInput:n,type:"number",min:"1",max:"1000",defaultValue:p(),ref:a,error:s.lifetimeInvalid})}),e.jsx(E,{label:"Expires on",helpText:"Alternatively, select a specific expiration date",children:e.jsx(U,{type:"date",value:c(),onInput:i})})]})})]})},kt=({parameters:t,updateOptionValue:r,errors:s})=>{const a=i=>{let c;i.currentTarget.validity.valid?c=i.currentTarget.value===""?void 0:parseInt(i.currentTarget.value,10):c=NaN,r("sampleFileCount",c)},n=()=>t.sampleFileCount===void 0?"":isNaN(t.sampleFileCount)?-1:t.sampleFileCount;return e.jsxs(Ce,{className:"space-y-0",children:[e.jsx(De,{variant:"outline",className:"font-medium text-neutral-900 dark:text-neutral-100",children:"Advanced Options"}),e.jsx(Re,{variant:"outline",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(E,{label:"Grouping",helpText:"Defines how files in datasets/containers are grouped for replication",error:s.groupingInvalid,errorMessage:"The value of grouping is invalid",children:e.jsxs(ot,{onValueChange:i=>{r("grouping",i===Q?void 0:i)},defaultValue:t.grouping??Q,children:[e.jsx(dt,{children:e.jsx(ut,{placeholder:"Grouping"})}),e.jsx(ct,{children:e.jsxs(mt,{children:[e.jsx(V,{value:Q,children:"Undefined"}),e.jsx(V,{value:k.ALL,children:"All"}),e.jsx(V,{value:k.DATASET,children:"Dataset"}),e.jsx(V,{value:k.NONE,children:"None"})]})})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(F,{checked:t.asynchronous,onChange:()=>r("asynchronous",!t.asynchronous),label:"Asynchronous"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 ml-7",children:"Create rule asynchronously in the background"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(F,{checked:t.sample,onChange:()=>r("sample",!t.sample),label:"Create a sample"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 ml-7",children:"Create a rule for a random sample of files"})]}),t.sample&&e.jsx(E,{label:"Number of files",helpText:"Specify how many files to include in the sample",error:s.sampleCountInvalid,errorMessage:"Number of files should be greater than 1 or not specified",children:e.jsx(U,{type:"number",min:"1",onInput:a,defaultValue:n(),error:s.sampleCountInvalid})})]})})]})},Q="undefined",Fe=({parameters:t,updateOptionValue:r,errors:s})=>{const a=i=>{const c=parseInt(i.target.value,10);r("copies",c)},n=isNaN(t.copies)?"":t.copies;return e.jsx("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm p-6",children:e.jsxs("div",{className:"flex flex-col divide-y divide-neutral-200 dark:divide-neutral-700",children:[e.jsxs("div",{className:"space-y-4 pb-6",children:[e.jsx(E,{label:"Copies",required:!0,helpText:`Number of replicas to create (max: ${t.rses.length} based on selected RSEs)`,error:s.copiesInvalid,errorMessage:`Copies should range from 1 to ${t.rses.length} (number of chosen RSEs)`,children:e.jsx(U,{onChange:a,type:"number",min:"1",max:t.rses.length,defaultValue:n,error:s.copiesInvalid})}),!s.copiesInvalid&&s.tooManyCopies&&e.jsx(Ne,{children:e.jsxs("span",{children:["There are less than ",e.jsx("b",{children:t.copies})," chosen RSEs with enough quota left. Please change the number of"," ",e.jsx("b",{children:"copies"})," or mark the rule as needing approval in Step 2."]})})]}),e.jsx("div",{className:"py-6",children:e.jsx(Tt,{parameters:t,updateOptionValue:r,errors:s})}),e.jsx("div",{className:"pt-6 pb-6",children:e.jsx(E,{label:"Comments",required:t.askApproval,helpText:t.askApproval?"Required when asking for approval":"Optional comments about this rule",error:s.commentsEmpty,errorMessage:"A comment should be specified when asking for approval",children:e.jsx(lt,{onChange:i=>r("comments",i.target.value),defaultValue:t.comments,error:s.commentsEmpty})})}),e.jsxs("div",{className:"space-y-3 pt-6 pb-6",children:[e.jsx(F,{checked:t.notify,onChange:()=>r("notify",!t.notify),label:"Receive notifications"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 ml-7",children:"Get notified when the rule state changes"})]}),e.jsx("div",{className:"pt-6",children:e.jsx(kt,{parameters:t,updateOptionValue:r,errors:s})})]})})};Fe.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageOptions",props:{parameters:{required:!0,tsType:{name:"CreateRuleParameters"},description:""},updateOptionValue:{required:!0,tsType:{name:"signature",type:"function",raw:"(key: keyof CreateRuleOptions, value: any) => void",signature:{arguments:[{type:{name:"CreateRuleOptions"},name:"key"},{type:{name:"any"},name:"value"}],return:{name:"void"}}},description:""},errors:{required:!0,tsType:{name:"signature",type:"object",raw:`{
    tooManyCopies: boolean;
    copiesInvalid: boolean;
    lifetimeInvalid: boolean;
    commentsEmpty: boolean;
    groupingInvalid: boolean;
    sampleCountInvalid: boolean;
}`,signature:{properties:[{key:"tooManyCopies",value:{name:"boolean",required:!0}},{key:"copiesInvalid",value:{name:"boolean",required:!0}},{key:"lifetimeInvalid",value:{name:"boolean",required:!0}},{key:"commentsEmpty",value:{name:"boolean",required:!0}},{key:"groupingInvalid",value:{name:"boolean",required:!0}},{key:"sampleCountInvalid",value:{name:"boolean",required:!0}}]}},description:""}}};const Et={[h.FILE]:"File",[h.DATASET]:"Dataset",[h.CONTAINER]:"Container",[h.COLLECTION]:"Collection",[h.ALL]:"All"},Me=t=>{const r=m.useRef(null),[s]=m.useState([{headerName:"Identifier",valueGetter:a=>{var n,i;return`${(n=a.data)==null?void 0:n.scope}:${(i=a.data)==null?void 0:i.name}`},flex:1,minWidth:400,pinned:"left",filter:!0,filterParams:O},{headerName:"Type",field:"did_type",cellRenderer:J,minWidth:180,cellStyle:Z,cellRendererParams:{className:X},filter:!0,filterParams:Y(Object.values(Et),Object.values(h))},{headerName:"Copies",valueGetter:()=>t.copies,minWidth:100,filter:"agNumberColumnFilter"},{headerName:"Files",field:"length",minWidth:100,filter:"agNumberColumnFilter"},{headerName:"Size",field:"bytes",valueFormatter:a=>b(a.value),minWidth:200,filter:"agNumberColumnFilter"},{headerName:"Requested Size",valueGetter:a=>{var n,i;return(n=a.data)!=null&&n.bytes?((i=a.data)==null?void 0:i.bytes)*t.copies:NaN},valueFormatter:a=>b(a.value),minWidth:200,filter:"agNumberColumnFilter"},{headerName:"Is Open",field:"open",cellStyle:nt,cellRenderer:st,minWidth:100,filter:!0,filterParams:et}]);return e.jsx(G,{columnDefs:s,tableRef:r,...t})};Me.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageSummaryDataTable",props:{rowData:{required:!0,tsType:{name:"Array",elements:[{name:"ListDIDsViewModel"}],raw:"ListDIDsViewModel[]"},description:""},copies:{required:!0,tsType:{name:"number"},description:""}}};const oe=t=>{const r=t.warn?"text-base-error-500 font-semibold":"";return e.jsx("span",{className:r,children:t.value})},_t=t=>e.jsx(at,{href:`/rse/list?expression=${t.value}&autoSearch=true`,children:t.value}),Oe=({...t})=>{const r=m.useRef(null),[s]=m.useState([{headerName:"Name",field:"rse",minWidth:250,flex:1,pinned:"left",cellRenderer:_t,filter:!0,filterParams:O},{headerName:"Quota",field:"bytes_limit",cellRenderer:a=>{const n=a.data;if(n.bytes_limit===-1&&n.has_quota)return"Infinite";const i=a.value<0?"No quota":b(a.value);return e.jsx(oe,{warn:!n.has_quota,...a,value:i})},colSpan:a=>a.data.bytes_limit<0?2:1,minWidth:200,filter:"agNumberColumnFilter"},{headerName:"Remaining",field:"bytes_remaining",cellRenderer:a=>{const n=a.data,i=b(n.bytes_remaining);return e.jsx(oe,{warn:!n.has_quota,...a,value:i})},minWidth:200,filter:"agNumberColumnFilter"}]);return e.jsx(G,{tableRef:r,columnDefs:s,...t})};Oe.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageSummaryStorageTable",props:{rowData:{required:!0,tsType:{name:"Array",elements:[{name:"RSEAccountUsageLimitViewModel"}],raw:"RSEAccountUsageLimitViewModel[]"},description:""}}};const de=({label:t,value:r})=>e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-600 dark:text-neutral-400",children:t}),e.jsx("span",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100",children:r})]}),At=({dids:t})=>{const r=t.reduce((a,n)=>a+n.length,0),s=t.reduce((a,n)=>a+n.bytes,0);return e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(de,{label:"Total files",value:r}),e.jsx(de,{label:"Total size",value:b(s)})]})},D=({label:t,value:r,isBoolean:s})=>e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 border-b border-neutral-200 dark:border-neutral-700 last:border-b-0 bg-neutral-0 dark:bg-neutral-800",children:[e.jsx("span",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100",children:t}),s?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(we,{checked:r}),e.jsx("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:r?"Enabled":"Disabled"})]}):e.jsx("span",{className:"text-sm font-semibold text-neutral-900 dark:text-neutral-100",children:r})]}),qt=({parameters:t})=>{const r=t.sample&&t.sampleFileCount;return e.jsxs("div",{className:"space-y-0",children:[e.jsx(D,{label:"Copies",value:t.copies}),t.daysLifetime&&e.jsx(D,{label:"Lifetime",value:`${t.daysLifetime} days`}),e.jsx(D,{label:"Receive notifications",value:t.notify,isBoolean:!0}),e.jsx(D,{label:"Asynchronous",value:t.asynchronous,isBoolean:!0}),t.grouping&&e.jsx(D,{label:"Grouping",value:t.grouping}),t.comments&&e.jsx(D,{label:"Comments",value:t.comments}),r&&e.jsx(D,{label:"Sample file count",value:t.sampleFileCount??0})]})},We=({parameters:t})=>{const r=()=>{const a=t.dids.length>1?"s":"",n=t.sample?e.jsx("b",{children:"samples of"}):"";let i;return t.askApproval?i=e.jsxs("span",{children:["This request will ",e.jsx("b",{children:"ask for approval"})," to create a rule for ",n," the following DID",a,"."]}):i=e.jsxs("span",{children:["This request will create a rule for ",n," the following DID",a,"."]}),e.jsx(P,{children:i})},s=()=>{const a=t.dids.length>1?"s":"",n=t.rses.length>1?"s":"";return e.jsx(P,{children:e.jsxs("span",{children:["The rule",a," will replicate to one of the following RSE",n,"."]})})};return e.jsx("div",{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm",children:e.jsxs("div",{className:"flex flex-col divide-y divide-neutral-200 dark:divide-neutral-700",children:[e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(L,{text:"DIDs",size:"md"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Review the data identifiers (DIDs) that will be included in this rule"})]}),r(),t.dids.some(a=>a.open)&&e.jsx(P,{children:e.jsx("span",{children:"There are open DIDs present in your request. Everything that will be added to them after you created the rule will also be transferred to the selected RSEs."})})]}),e.jsx("div",{className:"p-6",children:e.jsx(R,{children:e.jsx(Me,{rowData:t.dids,copies:t.copies})})}),e.jsx("div",{className:"p-6",children:e.jsx(At,{dids:t.dids})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(L,{text:"RSEs",size:"md"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Review the Rucio Storage Elements (RSEs) where data will be replicated"})]}),s()]}),e.jsx("div",{className:"p-6",children:e.jsx(R,{children:e.jsx(Oe,{rowData:t.rses})})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(L,{text:"Options",size:"md"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Review the configuration options for this replication rule"})]}),e.jsx("div",{className:"rounded-lg border border-neutral-200 dark:border-neutral-700 overflow-hidden",children:e.jsx(qt,{parameters:t})})]})]})})};We.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageSummary",props:{parameters:{required:!0,tsType:{name:"CreateRuleParameters"},description:""}}};const Lt="|",Ve=({parameters:t,removeSaved:r})=>{const s=async()=>{var C;const o=t.rses.map(N=>N.rse).join(Lt),d=JSON.stringify({dids:t.dids.map(N=>({scope:N.scope,name:N.name})),copies:t.copies,rse_expression:o,grouping:(C=t.grouping)==null?void 0:C.toUpperCase(),lifetime_days:t.daysLifetime,notify:t.notify,comments:t.comments,ask_approval:t.askApproval,asynchronous:t.asynchronous,sample:t.sample,sample_file_count:t.sampleFileCount}),v=await fetch("/api/feature/create-rule",{method:"POST",body:d,headers:{"Content-Type":"application/json"}});let y;try{y=await v.json()}catch{throw new Error(v.statusText)}if(y.error)throw new Error(y.error);if(y.status!=="success"||y.rule_ids.length===0)throw new Error(y.message);return y},a=["create_rule"],{data:n,error:i,isFetching:c}=pt({queryKey:a,queryFn:s,enabled:!0,refetchOnWindowFocus:!1,refetchOnReconnect:!1,refetchOnMount:!1,retry:!1});xt(),m.useEffect(()=>{n&&r()},[n]);const p=()=>{const{resolvedTheme:o}=ht(),[d,g]=m.useState(!1),v=yt();if(m.useEffect(()=>{g(!0)},[]),!d)return e.jsx("div",{className:"w-32 h-32"});const y=o==="dark"?"/logo_dark.svg":"/logo_light.svg";return v?e.jsx("div",{className:"w-32 h-32 flex items-center justify-center",children:e.jsx(ie,{src:y,alt:"Rucio Logo",width:128,height:128,priority:!0,suppressHydrationWarning:!0})}):e.jsxs(S.div,{className:"relative w-32 h-32",initial:{scale:0,opacity:0,rotate:-180},animate:{scale:1,opacity:1,rotate:0},transition:{type:"spring",stiffness:200,damping:15,duration:.8},children:[e.jsx(S.div,{className:"absolute inset-0 rounded-full border-4 border-brand-500",initial:{scale:.8,opacity:0},animate:{scale:[.8,1.2,1],opacity:[0,1,0]},transition:{duration:2,repeat:1/0,repeatDelay:1}}),e.jsx(S.div,{className:"absolute inset-0 rounded-full bg-brand-500/10 dark:bg-brand-400/10 flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{delay:.3,type:"spring",stiffness:200,damping:15},children:e.jsx(S.div,{className:"absolute top-2 right-2 bg-brand-600 dark:bg-brand-500 rounded-full p-2",initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.6,type:"spring",stiffness:300,damping:12},children:e.jsx(K,{className:"w-5 h-5 text-white"})})}),e.jsx(S.div,{className:"relative w-full h-full flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.2,duration:.4},children:e.jsx(ie,{src:y,alt:"Rucio Logo",width:96,height:96,priority:!0,suppressHydrationWarning:!0})})]})},l=()=>{if(n)return e.jsxs(S.div,{className:"flex flex-col items-center space-y-6 max-w-2xl w-full",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4,duration:.6},children:[e.jsx(p,{}),e.jsxs(S.div,{className:"text-center space-y-2",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8,duration:.4},children:[e.jsx("h2",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100",children:"Rule Created Successfully!"}),e.jsxs("p",{className:"text-neutral-600 dark:text-neutral-400",children:["Your rule",n.rule_ids.length>1?"s have":" has"," been created and ",n.rule_ids.length>1?"are":"is"," now active."]})]}),e.jsx(S.div,{className:"rounded-lg bg-neutral-0 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm p-6 w-full",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:1,duration:.4},children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"w-5 h-5 text-brand-600 dark:text-brand-500"}),e.jsxs("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:["Rule ID",n.rule_ids.length>1?"s":""]})]}),e.jsx("ul",{className:"space-y-2",children:n.rule_ids.map((o,d)=>e.jsx(S.li,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:1.2+d*.1,duration:.3},children:e.jsxs(ne,{href:`/rule/page/${o}`,className:"flex items-center space-x-2 p-3 rounded-md bg-neutral-100 dark:bg-neutral-700 hover:bg-brand-50 dark:hover:bg-brand-900/20 transition-colors duration-200 border border-transparent hover:border-brand-500 dark:hover:border-brand-400",children:[e.jsx("span",{className:"text-neutral-900 dark:text-neutral-100 font-mono text-sm",children:o}),e.jsx("span",{className:"ml-auto text-brand-600 dark:text-brand-400 text-sm font-medium",children:"View Details â†’"})]})},o))})]})}),e.jsx(S.div,{className:"text-center text-neutral-600 dark:text-neutral-400",initial:{opacity:0},animate:{opacity:1},transition:{delay:1.4,duration:.4},children:e.jsxs("span",{children:["You can also view all your rules in the"," ",e.jsx(ne,{href:"/rule/list",className:"font-semibold text-brand-600 dark:text-brand-400 hover:underline",children:"rules list"})]})})]})};return e.jsxs("div",{className:"flex flex-col w-full grow justify-center items-center p-6",children:[c&&e.jsx("span",{className:"text-neutral-900 dark:text-neutral-100",children:"Creating..."}),i&&e.jsx(gt,{variant:"error",message:`Failed to create rule: ${i.toString()}. Please review the previous steps and try again.`,onClose:()=>{location.reload()}}),n&&l()]})};Ve.__docgenInfo={description:"",methods:[],displayName:"CreateRuleStageSubmission",props:{parameters:{required:!0,tsType:{name:"CreateRuleParameters"},description:""},removeSaved:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Pt=({activeIndex:t,setActiveIndex:r})=>{const s=t===0;return e.jsxs(ve,{variant:"neutral",className:"w-full sm:w-48 justify-between",disabled:s,onClick:()=>r(a=>a-1),children:[e.jsx(Xe,{}),e.jsx("span",{children:"Previous"})]})},Ft=({activeIndex:t,setActiveIndex:r,stepsLength:s,isStepIncomplete:a})=>{const n=t===s-2,i=t===s-1||a;return e.jsxs(ve,{variant:n?"success":"neutral",className:"w-full sm:w-48 ml-auto justify-between",disabled:i,onClick:()=>r(c=>c+1),children:[e.jsx("span",{children:n?"Submit":"Next"}),e.jsx(Ze,{})]})},ae=t=>{const[r,s]=m.useState(!0),[a,n]=m.useState(Ct()),[i,c]=m.useState(0),[p,l]=m.useState(le()),o=()=>{const u=a.dids.reduce((_,Ge)=>_+Ge.bytes,0),f=le(),{copies:j,daysLifetime:I,grouping:W,comments:Ue}=a;f.copiesInvalid=isNaN(j)||j<1||j>a.rses.length,f.tooManyCopies=!a.askApproval&&a.rses.filter(_=>!!(_.bytes_remaining>=u||_.bytes_limit===-1&&_.has_quota)).length<j,f.lifetimeInvalid=I!==void 0&&(isNaN(I)||I<1),f.commentsEmpty=a.askApproval&&!Ue,f.groupingInvalid=W!==void 0&&W!==k.DATASET&&W!==k.ALL&&W!==k.NONE,f.sampleCountInvalid=a.sample&&(!a.sampleFileCount||isNaN(a.sampleFileCount)||a.sampleFileCount<1),l(f)};m.useEffect(()=>{const u=t.getSavedParameters();u&&n(u);const f=t.getSavedIndex();f&&c(f),s(!1)},[]),m.useEffect(()=>{r||(t.setSavedParameters(a),o())},[a]),m.useEffect(()=>{r||i===4||t.setSavedIndex(i)},[i]);const d=u=>{n(f=>({...f,...u}))},g=u=>d(u),v=u=>d({needsApproval:u}),y=u=>d({askApproval:u}),C=(u,f)=>{n(j=>({...j,[u]:f}))},N=u=>{n(f=>f.dids.some(I=>I.scope===u.scope&&I.name===u.name)?f:{...f,dids:[...f.dids,u]})},z=u=>{n(f=>({...f,dids:f.dids.filter(j=>j.scope!==u.scope||j.name!==u.name)}))},$=()=>{let u=!1;return i>=0&&(u=u||a.dids.length===0),i>=1&&(u=u||a.rses.length===0||a.needsApproval&&!a.askApproval),i>=2&&(u=u||Object.values(p).some(f=>f)),u},x=["DIDs","RSEs","Options","Summary","Results"];if(r)return e.jsx("main",{className:"min-h-screen bg-neutral-0 dark:bg-neutral-900 transition-colors duration-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-10",children:e.jsx("div",{className:"flex w-full items-center justify-center min-h-[400px]",children:e.jsx(it,{})})})});const w=()=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between space-y-2 sm:space-y-0",children:[e.jsx(Pt,{activeIndex:i,setActiveIndex:c}),e.jsx(Ft,{activeIndex:i,setActiveIndex:c,stepsLength:x.length,isStepIncomplete:$()})]});return e.jsx("main",{className:"min-h-screen bg-neutral-0 dark:bg-neutral-900 transition-colors duration-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 lg:py-10",children:e.jsxs("div",{className:"flex flex-col space-y-6 w-full",children:[e.jsx("header",{className:"mb-2",children:e.jsx(L,{text:"New Rule"})}),e.jsx(Ie,{steps:x,activeIndex:i,onSwitch:i!==4?c:void 0}),e.jsxs("div",{children:[e.jsx(Ae,{visible:i===0,parameters:a,addDID:N,removeDID:z}),i===1&&e.jsx(Pe,{parameters:a,updateStorage:g,updateNeedsApproval:v,updateAskApproval:y}),i===2&&e.jsx(Fe,{parameters:a,updateOptionValue:C,errors:p}),i===3&&e.jsx(We,{parameters:a})]}),i===4&&e.jsx(Ve,{parameters:a,removeSaved:()=>{t.removeSavedIndex(),t.removeSavedParameters()}}),i!==4&&w()]})})})};ae.__docgenInfo={description:"",methods:[],displayName:"CreateRule",props:{getSavedParameters:{required:!0,tsType:{name:"signature",type:"function",raw:"() => CreateRuleParameters | undefined",signature:{arguments:[],return:{name:"union",raw:"CreateRuleParameters | undefined",elements:[{name:"CreateRuleParameters"},{name:"undefined"}]}}},description:""},getSavedIndex:{required:!0,tsType:{name:"signature",type:"function",raw:"() => number | undefined",signature:{arguments:[],return:{name:"union",raw:"number | undefined",elements:[{name:"number"},{name:"undefined"}]}}},description:""},setSavedParameters:{required:!0,tsType:{name:"signature",type:"function",raw:"(parameters: CreateRuleParameters) => void",signature:{arguments:[{type:{name:"CreateRuleParameters"},name:"parameters"}],return:{name:"void"}}},description:""},setSavedIndex:{required:!0,tsType:{name:"signature",type:"function",raw:"(activeIndex: number) => void",signature:{arguments:[{type:{name:"number"},name:"activeIndex"}],return:{name:"void"}}},description:""},removeSavedParameters:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},removeSavedIndex:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const Ga={title:"Components/Pages/Rule/Create",component:ae,parameters:{docs:{disable:!0}}},re=t=>{const r=new Nt;return e.jsx(ft,{client:r,children:e.jsx($e,{children:e.jsx(ae,{...t})})})},Mt=[{account:"",bytes_limit:-1,bytes_remaining:-1,files:-1,has_quota:!1,rse:"OOPS",rse_id:"oops",status:"success",total_expected_usage:-1,used_bytes:-1},{account:"",bytes_limit:10**13,bytes_remaining:10**13,files:-1,has_quota:!0,rse:"RSE-FULL",rse_id:"rse-full",status:"success",total_expected_usage:0,used_bytes:0},{account:"",bytes_limit:1e3,bytes_remaining:-100,files:-1,has_quota:!1,rse:"RSE-LACKING",rse_id:"rse-lacking",status:"success",total_expected_usage:900,used_bytes:800}],T=re.bind({});T.args={getSavedParameters:()=>{},getSavedIndex:()=>{},setSavedIndex:()=>{},setSavedParameters:()=>{},removeSavedParameters:()=>{},removeSavedIndex:()=>{}};T.decorators=[vt([se("/api/feature/list-dids",{data:Array.from({length:200},bt),delay:1}),se("/api/feature/list-account-rse-quotas",{data:Mt,delay:1,method:"POST"}),wt("/api/feature/create-rule",{getDelay:()=>500,method:"POST",getData:()=>({rule_ids:["test"],status:"success"})})])];const A=re.bind({});A.args={getSavedParameters:()=>{},getSavedIndex:()=>2,setSavedIndex:()=>{},setSavedParameters:()=>{},removeSavedParameters:()=>{},removeSavedIndex:()=>{}};const q=re.bind({});q.args={getSavedParameters:()=>({askApproval:!1,asynchronous:!1,comments:"",copies:3,daysLifetime:void 0,dids:Array.from({length:3},St),grouping:void 0,sample:!1,needsApproval:!1,notify:!1,rseExpression:"",rses:[jt()],sampleFileCount:0}),getSavedIndex:()=>3,setSavedIndex:()=>{},setSavedParameters:()=>{},removeSavedParameters:()=>{},removeSavedIndex:()=>{}};var ue,ce,me;T.parameters={...T.parameters,docs:{...(ue=T.parameters)==null?void 0:ue.docs,source:{originalSource:`args => {
  const queryClient = new QueryClient();
  return <QueryClientProvider client={queryClient}>
            <ToastedTemplate>
                <CreateRule {...args} />
            </ToastedTemplate>
        </QueryClientProvider>;
}`,...(me=(ce=T.parameters)==null?void 0:ce.docs)==null?void 0:me.source}}};var pe,fe,xe;A.parameters={...A.parameters,docs:{...(pe=A.parameters)==null?void 0:pe.docs,source:{originalSource:`args => {
  const queryClient = new QueryClient();
  return <QueryClientProvider client={queryClient}>
            <ToastedTemplate>
                <CreateRule {...args} />
            </ToastedTemplate>
        </QueryClientProvider>;
}`,...(xe=(fe=A.parameters)==null?void 0:fe.docs)==null?void 0:xe.source}}};var ge,he,ye;q.parameters={...q.parameters,docs:{...(ge=q.parameters)==null?void 0:ge.docs,source:{originalSource:`args => {
  const queryClient = new QueryClient();
  return <QueryClientProvider client={queryClient}>
            <ToastedTemplate>
                <CreateRule {...args} />
            </ToastedTemplate>
        </QueryClientProvider>;
}`,...(ye=(he=q.parameters)==null?void 0:he.docs)==null?void 0:ye.source}}};const za=["Regular","FromOptions","FromSummary"];export{A as FromOptions,q as FromSummary,T as Regular,za as __namedExportsOrder,Ga as default};
