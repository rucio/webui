import{r as s,j as e}from"./iframe-CbZ9RuD1.js";import{D as o}from"./rucio-BBdC5vD1.js";import{u as ne}from"./useToast-YXabfrDf.js";import{S as A,a as P,b as $,c as R,e as F,d as c}from"./select-BSUdR0U-.js";import{I as D}from"./input-DudEH1ht.js";import{S as se}from"./SearchButton-CIUEaMGJ.js";import{B as le}from"./button-CTUPBRYB.js";import{i as ie,j as oe}from"./index.esm-CDVKQKGR.js";import{U as ce}from"./index.esm-Bh9o6rCW.js";import{D as ue}from"./DateInput-74xO5tlQ.js";import{T as de}from"./TimeInput-CUCbVHI4.js";import{A as me}from"./Alert-DSW6oEjQ.js";const L=":",fe="Please specify both scope and name before the search.",pe='Neither scope nor name should contain ":".',he=(a,u)=>{if(!a)return;const[d,g,j]=(u||"00:00:00").split(":").map(Number),m=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),d,g,j)),i=N=>N.toString().padStart(2,"0");return`${m.getUTCFullYear()}-${i(m.getUTCMonth()+1)}-${i(m.getUTCDate())} ${i(m.getUTCHours())}:${i(m.getUTCMinutes())}:${i(m.getUTCSeconds())}`},xe=a=>{const d={"=":"length",">":"length.gt",">=":"length.gte","<":"length.lt","<=":"length.lte"}[a];if(!d)throw new Error(`Unsupported operator for length: ${a}`);return d},k=({label:a,children:u})=>e.jsxs("div",{className:"flex flex-col grow",children:[e.jsx("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2",children:a}),u]}),ge=a=>{var O;let u,d;const g=(O=a.initialPattern)==null?void 0:O.split(L);g&&g.length===2&&([u,d]=g);const[j,m]=s.useState(null);s.useEffect(()=>{a.initialPattern&&!u&&!d&&m(`Invalid URL pattern: could not resolve "${a.initialPattern}"`)},[]);const[i,N]=s.useState(u??null),[S,q]=s.useState(d??null),[f,K]=s.useState(a.initialType??o.DATASET),[v,_]=s.useState(""),[w,B]=s.useState("after"),[h,H]=s.useState(void 0),[y,Y]=s.useState(""),[T,G]=s.useState("="),[x,z]=s.useState(""),[b,J]=s.useState(!1),Q=()=>J(t=>!t),I=s.useRef(null),C=s.useRef(null),{toast:U}=ne(),M=(t,r,l)=>{var n;U({variant:"warning",title:t,description:r}),(n=l.current)==null||n.focus()},V=(t,r,l)=>{if(t){if(t.includes(L))return M(`":" in ${r}`,pe,l),!1}else return M(`Empty ${r}`,fe,l),!1;return!0},W=()=>V(i,"scope",I),X=()=>V(S,"name",C),Z={limit:v,length:{operator:T,value:x}},ee=(t,r,l)=>{if(r.limit){const n=Number(r.limit);if(!Number.isInteger(n)||n<0)return l({variant:"warning",title:"Invalid limit",description:"Limit must be a positive integer."}),!1}if(t===o.CONTAINER||t===o.DATASET){const n=r.length;if(n!=null&&n.value){const p=Number(n.value);if(!Number.isInteger(p))return l({variant:"warning",title:"Invalid length",description:"Length must be an integer value."}),!1}}return!0},E=t=>{if(t.preventDefault(),!W()||!X()||!ee(f,Z,U))return;a.onSearchStart&&i&&S&&a.onSearchStart({scope:i,name:S,type:f,limit:v||void 0,createdMode:h?w:void 0,createdDate:h||void 0,createdTime:h?y:void 0,lengthOperator:x?T:void 0,lengthValue:x||void 0});const r=new URLSearchParams({query:`${i}${L}${S}`,type:f});if(v&&r.append("filters",`limit=${v}`),h){const n=he(h,y);if(n){const p=w==="before"?"created_before":"created_after";r.append("filters",`${p}=${n}`)}}if((f===o.CONTAINER||f===o.DATASET)&&x){const n=xe(T),p=Number(x);Number.isNaN(p)||r.append("filters",`${n}=${p}`)}const l="/api/feature/list-dids?"+r.toString();a.startStreaming(l)},te=t=>{t.preventDefault(),a.stopStreaming()},ae=t=>{var r;if(t.key==="ArrowRight"){const l=t.currentTarget,n=l.selectionStart,p=l.value.length;n===p&&((r=C.current)==null||r.focus())}},re=t=>{var r;t.key==="ArrowLeft"&&t.currentTarget.selectionStart===0&&((r=I.current)==null||r.focus())};return e.jsxs("div",{className:"flex flex-col space-y-4 w-full",children:[j&&e.jsx(me,{variant:"warning",message:j,onClose:()=>m(null)}),e.jsxs("div",{className:"flex flex-col md:items-start md:flex-row md:space-y-0 md:space-x-2",children:[e.jsxs("div",{className:"flex flex-col grow sm:flex-row space-y-2 sm:space-x-2 sm:space-y-0",children:[e.jsxs(A,{onValueChange:t=>K(t),defaultValue:f,children:[e.jsx(P,{className:"w-full sm:w-48",children:e.jsx($,{placeholder:"Type"})}),e.jsx(R,{children:e.jsxs(F,{children:[e.jsx(c,{value:o.CONTAINER,children:"Container"}),e.jsx(c,{value:o.DATASET,children:"Dataset"}),e.jsx(c,{value:o.FILE,children:"File"})]})})]}),e.jsxs("div",{className:"w-full flex flex-row space-x-2 items-center",children:[e.jsx(D,{ref:I,placeholder:"scope",className:"max-w-[250px]",defaultValue:u,onChange:t=>{N(t.target.value)},onEnterKey:E,onKeyDown:ae}),e.jsx("span",{className:"text-neutral-900 dark:text-neutral-100 font-bold",children:":"}),e.jsx(D,{ref:C,placeholder:"name",defaultValue:d,onChange:t=>{q(t.target.value)},onEnterKey:E,onKeyDown:re}),e.jsxs(le,{className:"px-3",variant:"neutral",onClick:Q,"aria-expanded":b,"aria-label":"Toggle filters",children:[e.jsx(ce,{}),b?e.jsx(ie,{className:"ml-1"}):e.jsx(oe,{className:"ml-1"})]})]})]}),e.jsx(se,{className:"sm:w-full md:w-48",isRunning:a.isRunning,onStop:te,onSearch:E})]}),b&&e.jsxs("div",{className:"rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 p-6 space-y-6",children:[e.jsx(k,{label:"Created",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 w-full",children:[e.jsxs(A,{value:w,onValueChange:t=>B(t),children:[e.jsx(P,{className:"w-full sm:w-32 flex-shrink-0",children:e.jsx($,{placeholder:"Mode"})}),e.jsx(R,{children:e.jsxs(F,{children:[e.jsx(c,{value:"after",children:"After"}),e.jsx(c,{value:"before",children:"Before"})]})})]}),e.jsxs("div",{className:"flex flex-row flex-1 gap-2",children:[e.jsx("div",{className:"flex-grow-[2]",children:e.jsx(ue,{onchange:t=>H(t),initialdate:h,placeholder:"Select date"})}),e.jsx("div",{className:"flex-grow",children:e.jsx(de,{onchange:t=>Y(t),initialtime:y,placeholder:"Select time",showSeconds:!0})})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(k,{label:"Limit",children:e.jsx(D,{type:"number",value:v,onChange:t=>_(t.target.value),placeholder:"Maximum number of DID returned",className:"w-full"})}),(f===o.CONTAINER||f===o.DATASET)&&e.jsx(k,{label:"Length",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{value:T,onValueChange:t=>G(t),children:[e.jsx(P,{className:"w-20 flex-shrink-0",children:e.jsx($,{placeholder:"="})}),e.jsx(R,{children:e.jsxs(F,{children:[e.jsx(c,{value:"=",children:"="}),e.jsx(c,{value:">",children:">"}),e.jsx(c,{value:"<",children:"<"}),e.jsx(c,{value:">=",children:"≥"}),e.jsx(c,{value:"<=",children:"≤"})]})})]}),e.jsx(D,{type:"number",value:x,onChange:t=>z(t.target.value),placeholder:"Number of attached DIDs",className:"w-full"})]})})]})]})]})};ge.__docgenInfo={description:"",methods:[],displayName:"DIDSearchPanel",props:{startStreaming:{required:!0,tsType:{name:"signature",type:"function",raw:"(url: string) => void",signature:{arguments:[{type:{name:"string"},name:"url"}],return:{name:"void"}}},description:""},stopStreaming:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},initialPattern:{required:!1,tsType:{name:"string"},description:""},isRunning:{required:!0,tsType:{name:"boolean"},description:""},autoSearch:{required:!1,tsType:{name:"boolean"},description:""},initialType:{required:!1,tsType:{name:"DIDType"},description:""},onSearchStart:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: DIDSearchParams) => void",signature:{arguments:[{type:{name:"DIDSearchParams"},name:"params"}],return:{name:"void"}}},description:""}}};export{ge as D};
