import{r as n,j as e}from"./iframe-CbZ9RuD1.js";import{B as f}from"./button-CTUPBRYB.js";import{I as j}from"./input-DudEH1ht.js";import{S as J,a as Q,b as W,c as Y,d as Z}from"./select-BSUdR0U-.js";import{A as ee}from"./Alert-DSW6oEjQ.js";import{A as te,M as se,a as ae,b as re}from"./index-3wkwrokg.js";import{R as ne}from"./RucioLogo-je1npqWy.js";import{D as ie}from"./auth-models-DGfjT_QB.js";import{m as oe,n as le}from"./index.esm-Bh9o6rCW.js";import{L as ce}from"./link-CLCsOSg8.js";import{c as w}from"./utils-DsKtx5Xo.js";import{m as h}from"./proxy-vEXAzVUV.js";const de=s=>e.jsx(ce,{href:"/dashboard",children:e.jsxs(f,{variant:"success",className:"mb-1",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Back to dashboard as ",s.account]})}),ue=({submit:s,availableAccounts:d,onClose:N})=>{const[v,y]=n.useState(void 0);return e.jsxs(se,{isOpen:d.length!==0,onRequestClose:()=>{y(void 0),N()},ariaHideApp:!1,overlayClassName:"fixed inset-0 z-40 flex items-center justify-center bg-neutral-900/50 dark:bg-neutral-900/70 backdrop-blur-sm",className:w("mx-2 max-w-md w-full rounded-lg shadow-lg z-50","border border-neutral-200 dark:border-neutral-700","bg-neutral-0 dark:bg-neutral-800","flex flex-col space-y-4 p-6","justify-center items-center overflow-y-visible outline-none focus:outline-none"),contentLabel:"Select Account",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100 text-center",children:"Select Account"}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 text-center py-2",children:"Multiple accounts are mapped to the passed credentials. Choose one to continue."}),e.jsxs(J,{value:v,onValueChange:y,children:[e.jsx(Q,{className:"w-full","aria-label":"Select account",children:e.jsx(W,{placeholder:"Select an account"})}),e.jsx(Y,{children:d.map(b=>e.jsx(Z,{value:b,children:b},b))})]}),e.jsx(f,{type:"submit",disabled:v===void 0,onClick:async()=>{await s(v)},className:"w-full",children:"Select"})]})},me=({loginViewModel:s,authViewModel:d,userPassSubmitHandler:N,x509SubmitHandler:v,x509SessionHandler:y,oidcSubmitHandler:b})=>{const H=s.isLoggedIn&&s.accountActive!==void 0,[L,C]=n.useState("method-selection"),[u,q]=n.useState(0),[A,U]=n.useState(""),[S,D]=n.useState(""),[o,O]=n.useState(void 0),[k,l]=n.useState(void 0),[r,g]=n.useState({}),[m,E]=n.useState(!1),[R,P]=n.useState([]),[M,I]=n.useState(void 0),V=t=>{var i;if(t.status==="error")l(t.message);else if(t.status==="multiple_accounts"){const c=(i=t.message)==null?void 0:i.split(","),x=c==null?void 0:c.filter(G=>{var F;return!((F=s.accountsAvailable)!=null&&F.includes(G))});!x||x.length===0?l("All accounts associated with this identity are signed in to"):P(x)}},T=async t=>{var x;if(t&&((x=s.accountsAvailable)!=null&&x.includes(t))){l(`Already authenticated as ${t}`);return}const i=s.voList[u]||ie,c=await v(i,s,t);c&&(I("x509"),V(c),y(c,c.rucioAccount,i.shortName))},K=()=>{const t={};return A.trim()||(t.username="Username is required"),S.trim()||(t.password="Password is required"),g(t),Object.keys(t).length===0},p=async t=>{var i;if(l(void 0),g({}),!!K()){if(t&&((i=s.accountsAvailable)!=null&&i.includes(t))){l(`Already authenticated as ${t}`);return}E(!0);try{N(A,S,s.voList[u],t),I("userpass")}finally{E(!1)}return Promise.resolve()}};n.useEffect(()=>{d?V(d):s&&s.status==="error"&&l(s.message)},[s,d]);const a=window.matchMedia("(prefers-reduced-motion: reduce)").matches,_={hidden:a?{opacity:1}:{opacity:0,scale:.8},visible:{opacity:1,scale:1,transition:a?{duration:0}:{duration:.5,ease:"easeInOut"}}},$={hidden:a?{opacity:1}:{opacity:0,scale:1.5},visible:{opacity:1,scale:1,transition:a?{duration:0}:{duration:.5,ease:"easeInOut"}}},B={enter:t=>({x:a?0:t>0?300:-300,opacity:a?1:0}),center:{x:0,opacity:1,transition:a?{duration:0}:{duration:.3,ease:"easeInOut"}},exit:t=>({x:a?0:t<0?300:-300,opacity:a?1:0,transition:a?{duration:0}:{duration:.3,ease:"easeInOut"}})},z=()=>e.jsxs(h.div,{custom:-1,variants:B,initial:"enter",animate:"center",exit:"exit",className:"w-full",children:[s.multiVOEnabled&&e.jsx("div",{className:"mb-4",children:e.jsx(ae,{tabs:s.voList.map(t=>t.name),activeIndex:u,onTabChange:t=>q(t),ariaLabel:"Select Virtual Organisation"})}),e.jsxs("div",{className:"flex justify-center flex-col space-y-3 mt-4","aria-label":"Choose Login Method",children:[s.oidcEnabled&&e.jsx("div",{className:w("flex flex-row justify-center gap-2",s.voList[u].oidcEnabled?"":"hidden"),"aria-label":"OIDC Login Buttons",children:s.voList[u].oidcProviders.map((t,i)=>e.jsxs(f,{variant:"neutral",onClick:()=>b(t,s.voList[u],o),children:[e.jsx(re,{className:"mr-2 h-5 w-5"}),t.name]},i.toString()))}),e.jsx(f,{onClick:()=>T(o),children:"x509"}),s.userpassEnabled&&e.jsx(f,{onClick:()=>{l(void 0),g({}),C("userpass-form")},children:"Userpass"}),!s.userpassEnabled&&e.jsxs("div",{className:"space-y-2 px-2",children:[e.jsxs("label",{htmlFor:"account-input-nouserpass",className:"block text-sm font-medium text-neutral-900 dark:text-neutral-100",children:["Account ",e.jsx("span",{className:"text-neutral-500 dark:text-neutral-500",children:"(optional)"})]}),e.jsx(j,{id:"account-input-nouserpass",type:"text",value:o||"",onChange:t=>O(t.target.value||void 0),placeholder:"Enter account name",className:"w-full"})]})]})]},"method-selection"),X=()=>e.jsxs(h.div,{custom:1,variants:B,initial:"enter",animate:"center",exit:"exit",className:"w-full",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{type:"button",onClick:()=>{l(void 0),g({}),C("method-selection")},className:w("flex items-center gap-2","text-sm text-neutral-700 dark:text-neutral-300","hover:text-neutral-900 dark:hover:text-neutral-100","transition-colors duration-150","focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2","rounded px-2 py-1"),"aria-label":"Back to login methods",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{children:"Back"})]})}),e.jsx(h.form,{onSubmit:t=>{t.preventDefault(),p(o)},animate:r.username||r.password?a?{}:{x:[0,-10,10,-10,10,0]}:{},transition:{duration:.4},children:e.jsxs("fieldset",{className:"flex flex-col space-y-4","aria-label":"Userpass Login Fields",id:"userpass-form",children:[e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username-input",className:"block text-sm font-medium text-neutral-900 dark:text-neutral-100",children:"Username"}),e.jsx(j,{id:"username-input",type:"text",value:A,onChange:t=>U(t.target.value),error:!!r.username,"aria-describedby":r.username?"username-error":void 0,"aria-invalid":!!r.username,disabled:m,placeholder:"Enter your username",onEnterKey:()=>p(o),className:"w-full"}),e.jsx("div",{className:"min-h-[20px]",children:r.username&&e.jsx("p",{id:"username-error",className:"text-sm text-base-error-600 dark:text-base-error-400",children:r.username})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password-input",className:"block text-sm font-medium text-neutral-900 dark:text-neutral-100",children:"Password"}),e.jsx(j,{id:"password-input",type:"password",value:S,onChange:t=>D(t.target.value),error:!!r.password,"aria-describedby":r.password?"password-error":void 0,"aria-invalid":!!r.password,disabled:m,placeholder:"Enter your password",onEnterKey:()=>p(o),className:"w-full"}),e.jsx("div",{className:"min-h-[20px]",children:r.password&&e.jsx("p",{id:"password-error",className:"text-sm text-base-error-600 dark:text-base-error-400",children:r.password})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"account-input",className:"block text-sm font-medium text-neutral-900 dark:text-neutral-100",children:["Account ",e.jsx("span",{className:"text-neutral-500 dark:text-neutral-500",children:"(optional)"})]}),e.jsx(j,{id:"account-input",type:"text",value:o||"",onChange:t=>O(t.target.value||void 0),disabled:m,placeholder:"Enter account name",onEnterKey:()=>p(o),className:"w-full"})]})]}),e.jsx(f,{type:"submit",onClick:()=>p(o),disabled:m,loading:m,className:"w-full",children:m?"Signing in...":"Login"})]})})]},"userpass-form");return e.jsx(h.div,{initial:"hidden",animate:"visible",variants:$,className:"flex items-center justify-center min-h-screen py-8",children:e.jsxs("div",{children:[H&&e.jsx("div",{className:"mb-4",children:e.jsx(de,{account:s.accountActive})}),e.jsxs("div",{className:w("flex flex-col items-center justify-between","border rounded-xl p-4 md:p-6","border-neutral-300 dark:border-neutral-700","bg-neutral-50/90 dark:bg-neutral-900/90","backdrop-blur-xl","w-[90vw] md:w-[480px] mx-auto","shadow-lg"),id:"root",children:[e.jsx(ue,{submit:M==="x509"?T:p,availableAccounts:R,onClose:()=>P([])}),e.jsx("div",{className:`min-h-[52px] w-full ${k?"":"hidden"}`,role:"alert","aria-live":"polite","aria-atomic":"true","data-testid":"login-page-error",children:k&&e.jsx(h.div,{initial:a?{opacity:1}:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:a?{opacity:1}:{opacity:0,y:-10},transition:a?{duration:0}:{duration:.2,ease:"easeInOut"},children:e.jsx(ee,{variant:"error",message:k,onClose:()=>{l(void 0)}})})}),e.jsx("div",{className:"flex flex-col items-center justify-between w-full text-center p-4",children:e.jsx(h.div,{initial:"hidden",animate:"visible",variants:_,children:e.jsx(ne,{className:"text-neutral-900 dark:text-neutral-100",width:120,height:120,"aria-label":"Rucio Logo"})})}),e.jsx("div",{className:"w-full overflow-hidden",children:e.jsx(te,{mode:"wait",custom:L==="userpass-form"?1:-1,children:L==="method-selection"?z():X()})})]})]})})};me.__docgenInfo={description:"",methods:[],displayName:"Login",props:{loginViewModel:{required:!0,tsType:{name:"LoginViewModel"},description:""},authViewModel:{required:!0,tsType:{name:"union",raw:"AuthViewModel | undefined",elements:[{name:"AuthViewModel"},{name:"undefined"}]},description:""},userPassSubmitHandler:{required:!0,tsType:{name:"signature",type:"function",raw:"(username: string, password: string, vo: VO, account?: string) => void",signature:{arguments:[{type:{name:"string"},name:"username"},{type:{name:"string"},name:"password"},{type:{name:"VO"},name:"vo"},{type:{name:"string"},name:"account"}],return:{name:"void"}}},description:""},x509SubmitHandler:{required:!0,tsType:{name:"signature",type:"function",raw:"(vo: VO, loginViewModel: LoginViewModel, account?: string) => Promise<AuthViewModel | undefined>",signature:{arguments:[{type:{name:"VO"},name:"vo"},{type:{name:"LoginViewModel"},name:"loginViewModel"},{type:{name:"string"},name:"account"}],return:{name:"Promise",elements:[{name:"union",raw:"AuthViewModel | undefined",elements:[{name:"AuthViewModel"},{name:"undefined"}]}],raw:"Promise<AuthViewModel | undefined>"}}},description:""},x509SessionHandler:{required:!0,tsType:{name:"signature",type:"function",raw:"(authViewModel: AuthViewModel, rucioAccount: string, shortVoName: string) => void",signature:{arguments:[{type:{name:"AuthViewModel"},name:"authViewModel"},{type:{name:"string"},name:"rucioAccount"},{type:{name:"string"},name:"shortVoName"}],return:{name:"void"}}},description:""},oidcSubmitHandler:{required:!0,tsType:{name:"signature",type:"function",raw:"(oidcProvider: OIDCProvider, vo: VO, account?: string) => void",signature:{arguments:[{type:{name:"OIDCProvider"},name:"oidcProvider"},{type:{name:"VO"},name:"vo"},{type:{name:"string"},name:"account"}],return:{name:"void"}}},description:""}}};export{me as L};
